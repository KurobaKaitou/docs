<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/docs/avatar.jpg"><title>hikari</title><meta name="description" content="è¿™æ˜¯ä¸€ä¸ªç”±Vuepressæ„å»ºçš„æ–‡æ¡£">
    <link rel="preload" href="/docs/assets/style-c935053b.css" as="style"><link rel="stylesheet" href="/docs/assets/style-c935053b.css">
    <link rel="modulepreload" href="/docs/assets/app-62a6500d.js"><link rel="modulepreload" href="/docs/assets/framework-5866ffd3.js"><link rel="modulepreload" href="/docs/assets/index.html-0de237f2.js"><link rel="modulepreload" href="/docs/assets/index.html-c96f5afb.js"><link rel="prefetch" href="/docs/assets/index.html-383633da.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-a95c46e6.js" as="script"><link rel="prefetch" href="/docs/assets/linkedList.html-a3d7a96e.js" as="script"><link rel="prefetch" href="/docs/assets/preview.html-9ee9a253.js" as="script"><link rel="prefetch" href="/docs/assets/queue.html-60e701d6.js" as="script"><link rel="prefetch" href="/docs/assets/sparseArray.html-0776adce.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-c79c476e.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-f46d836c.js" as="script"><link rel="prefetch" href="/docs/assets/advanced.html-85e82102.js" as="script"><link rel="prefetch" href="/docs/assets/introduction.html-a8dc9ee2.js" as="script"><link rel="prefetch" href="/docs/assets/nio.html-4b78994c.js" as="script"><link rel="prefetch" href="/docs/assets/optimization.html-9490162e.js" as="script"><link rel="prefetch" href="/docs/assets/getting-start.html-e6bbef44.js" as="script"><link rel="prefetch" href="/docs/assets/object-oriented.html-04725dde.js" as="script"><link rel="prefetch" href="/docs/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-b8dd3d92.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-6697317f.js" as="script"><link rel="prefetch" href="/docs/assets/linkedList.html-9c776677.js" as="script"><link rel="prefetch" href="/docs/assets/preview.html-35877bd4.js" as="script"><link rel="prefetch" href="/docs/assets/queue.html-f61622b0.js" as="script"><link rel="prefetch" href="/docs/assets/sparseArray.html-4ef92efa.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-5b6b7942.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-b877eddb.js" as="script"><link rel="prefetch" href="/docs/assets/advanced.html-ed9b9bfd.js" as="script"><link rel="prefetch" href="/docs/assets/introduction.html-baa9fc63.js" as="script"><link rel="prefetch" href="/docs/assets/nio.html-3d122a42.js" as="script"><link rel="prefetch" href="/docs/assets/optimization.html-021a0d9d.js" as="script"><link rel="prefetch" href="/docs/assets/getting-start.html-f745e18c.js" as="script"><link rel="prefetch" href="/docs/assets/object-oriented.html-04ddeefe.js" as="script"><link rel="prefetch" href="/docs/assets/404.html-87d54bd8.js" as="script"><link rel="prefetch" href="/docs/assets/mermaid.core-e1c2e8b8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/docs/" class=""><!----><span class="site-name">hikari</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/docs/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/docs/preview/" class="" aria-label="å‰è¨€"><!--[--><!--]--> å‰è¨€ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/docs/datastruct/preview.md" class="" aria-label="æ•°æ®ç»“æ„"><!--[--><!--]--> æ•°æ®ç»“æ„ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Frontend"><span class="title">å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Frontend"><span class="title">å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/docs/frontend/typescript/getting-start.md" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/docs/frontend/promise/" class="router-link-active router-link-exact-active router-link-active" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Backend"><span class="title">åç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Backend"><span class="title">åç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/docs/backend/netty/nio.md" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/docs/backend/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Other"><span class="title">æ›´å¤š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Other"><span class="title">æ›´å¤š</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/docs/bookmark/" class="" aria-label="ä¹¦ç­¾"><!--[--><!--]--> ä¹¦ç­¾ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhilin.club/alist/" rel="noopener noreferrer" target="_blank" aria-label="æ–‡ä»¶å°å±‹"><!--[--><!--]--> æ–‡ä»¶å°å±‹ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ç«™ç‚¹</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://java-design-patterns.com" rel="noopener noreferrer" target="_blank" aria-label="Design Pattern"><!--[--><!--]--> Design Pattern <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å‹é“¾</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://dreamluffe.github.io/" rel="noopener noreferrer" target="_blank" aria-label="Luffy&#39;s Blog"><!--[--><!--]--> Luffy&#39;s Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://lzangle.github.io/lzBlog/" rel="noopener noreferrer" target="_blank" aria-label="Lz&#39;s Blog"><!--[--><!--]--> Lz&#39;s Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://www.travellings.cn/go.html" rel="noopener noreferrer" target="_blank" aria-label="ğŸš‡ å¼€å¾€"><!--[--><!--]--> ğŸš‡ å¼€å¾€ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/KurobaKaitou/docs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="ctrl + f æœç´¢" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/docs/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/docs/preview/" class="" aria-label="å‰è¨€"><!--[--><!--]--> å‰è¨€ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/docs/datastruct/preview.md" class="" aria-label="æ•°æ®ç»“æ„"><!--[--><!--]--> æ•°æ®ç»“æ„ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Frontend"><span class="title">å‰ç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Frontend"><span class="title">å‰ç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/docs/frontend/typescript/getting-start.md" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/docs/frontend/promise/" class="router-link-active router-link-exact-active router-link-active" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Backend"><span class="title">åç«¯</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Backend"><span class="title">åç«¯</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/docs/backend/netty/nio.md" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/docs/backend/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Other"><span class="title">æ›´å¤š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Other"><span class="title">æ›´å¤š</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/docs/bookmark/" class="" aria-label="ä¹¦ç­¾"><!--[--><!--]--> ä¹¦ç­¾ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhilin.club/alist/" rel="noopener noreferrer" target="_blank" aria-label="æ–‡ä»¶å°å±‹"><!--[--><!--]--> æ–‡ä»¶å°å±‹ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ç«™ç‚¹</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://java-design-patterns.com" rel="noopener noreferrer" target="_blank" aria-label="Design Pattern"><!--[--><!--]--> Design Pattern <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å‹é“¾</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://dreamluffe.github.io/" rel="noopener noreferrer" target="_blank" aria-label="Luffy&#39;s Blog"><!--[--><!--]--> Luffy&#39;s Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://lzangle.github.io/lzBlog/" rel="noopener noreferrer" target="_blank" aria-label="Lz&#39;s Blog"><!--[--><!--]--> Lz&#39;s Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://www.travellings.cn/go.html" rel="noopener noreferrer" target="_blank" aria-label="ğŸš‡ å¼€å¾€"><!--[--><!--]--> ğŸš‡ å¼€å¾€ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/KurobaKaitou/docs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/frontend/promise/#ä¸€ã€å‰è¨€-ä¸ºä»€ä¹ˆä¼šå‡ºç°promise" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¸€ã€å‰è¨€ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°Promise?"><!--[--><!--]--> ä¸€ã€å‰è¨€ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°Promise? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#äºŒã€promiseæ˜¯ä»€ä¹ˆ" class="router-link-active router-link-exact-active sidebar-item" aria-label="äºŒã€Promiseæ˜¯ä»€ä¹ˆ?"><!--[--><!--]--> äºŒã€Promiseæ˜¯ä»€ä¹ˆ? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#ä¸‰ã€ä½¿ç”¨promiseçš„å¥½å¤„" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¸‰ã€ä½¿ç”¨Promiseçš„å¥½å¤„?"><!--[--><!--]--> ä¸‰ã€ä½¿ç”¨Promiseçš„å¥½å¤„? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#å››ã€promiseå®ä¾‹å¯¹è±¡çš„ä¸¤ä¸ªå±æ€§" class="router-link-active router-link-exact-active sidebar-item" aria-label="å››ã€Promiseå®ä¾‹å¯¹è±¡çš„ä¸¤ä¸ªå±æ€§"><!--[--><!--]--> å››ã€Promiseå®ä¾‹å¯¹è±¡çš„ä¸¤ä¸ªå±æ€§ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#äº”ã€resolveå‡½æ•°ä»¥åŠrejectå‡½æ•°" class="router-link-active router-link-exact-active sidebar-item" aria-label="äº”ã€resolveå‡½æ•°ä»¥åŠrejectå‡½æ•°"><!--[--><!--]--> äº”ã€resolveå‡½æ•°ä»¥åŠrejectå‡½æ•° <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#å…­ã€promiseå¯¹è±¡çš„çŠ¶æ€" class="router-link-active router-link-exact-active sidebar-item" aria-label="å…­ã€Promiseå¯¹è±¡çš„çŠ¶æ€"><!--[--><!--]--> å…­ã€Promiseå¯¹è±¡çš„çŠ¶æ€ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#ä¸ƒã€promiseçš„thenæ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¸ƒã€Promiseçš„thenæ–¹æ³•"><!--[--><!--]--> ä¸ƒã€Promiseçš„thenæ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#å…«ã€promiseçš„é“¾å¼è°ƒç”¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="å…«ã€Promiseçš„é“¾å¼è°ƒç”¨"><!--[--><!--]--> å…«ã€Promiseçš„é“¾å¼è°ƒç”¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#ä¹ã€promiseä¸‹çš„å‡ ç§æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¹ã€Promiseä¸‹çš„å‡ ç§æ–¹æ³•"><!--[--><!--]--> ä¹ã€Promiseä¸‹çš„å‡ ç§æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#åã€ç»ˆæ­¢promiseé“¾æ¡" class="router-link-active router-link-exact-active sidebar-item" aria-label="åã€ç»ˆæ­¢Promiseé“¾æ¡"><!--[--><!--]--> åã€ç»ˆæ­¢Promiseé“¾æ¡ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#åä¸€ã€å‡ ä¸ªå…³é”®é—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="åä¸€ã€å‡ ä¸ªå…³é”®é—®é¢˜"><!--[--><!--]--> åä¸€ã€å‡ ä¸ªå…³é”®é—®é¢˜ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#åäºŒã€asyncå’Œawait" class="router-link-active router-link-exact-active sidebar-item" aria-label="åäºŒã€asyncå’Œawait"><!--[--><!--]--> åäºŒã€asyncå’Œawait <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#åä¸‰ã€jsä¸­çš„å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ—" class="router-link-active router-link-exact-active sidebar-item" aria-label="åä¸‰ã€JSä¸­çš„å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ—"><!--[--><!--]--> åä¸‰ã€JSä¸­çš„å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ— <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#åå››ã€promiseå¸¸è§é¢è¯•é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="åå››ã€Promiseå¸¸è§é¢è¯•é¢˜"><!--[--><!--]--> åå››ã€Promiseå¸¸è§é¢è¯•é¢˜ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/frontend/promise/#åäº”ã€æ‰‹å†™promiseè‡ªå®šä¹‰åŸºç¡€ç»“æ„çš„æ­å»º" class="router-link-active router-link-exact-active sidebar-item" aria-label="åäº”ã€æ‰‹å†™promiseè‡ªå®šä¹‰åŸºç¡€ç»“æ„çš„æ­å»º"><!--[--><!--]--> åäº”ã€æ‰‹å†™promiseè‡ªå®šä¹‰åŸºç¡€ç»“æ„çš„æ­å»º <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h3 id="ä¸€ã€å‰è¨€-ä¸ºä»€ä¹ˆä¼šå‡ºç°promise" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€-ä¸ºä»€ä¹ˆä¼šå‡ºç°promise" aria-hidden="true">#</a> ä¸€ã€å‰è¨€ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°Promise?</h3><p>Promiseçš„é‡è¦æ€§æˆ‘è®¤ä¸ºæ²¡æœ‰å¿…è¦å¤šè®²ï¼Œæ¦‚æ‹¬èµ·æ¥è¯´å°±æ˜¯äº”ä¸ªå­—ï¼š<strong>å¿…ï¼é¡»ï¼å¾—ï¼æŒï¼æ¡ï¼</strong>ã€‚</p><p>è€Œä¸”è¿˜è¦æŒæ¡é€å½»ï¼Œåœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œæœ‰éå¸¸å¤šçš„åº”ç”¨åœºæ™¯æˆ‘ä»¬ä¸èƒ½ç«‹å³çŸ¥é“åº”è¯¥å¦‚ä½•ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p><p>æœ€å¸¸è§çš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯ajaxè¯·æ±‚ï¼Œé€šä¿—æ¥è¯´ï¼Œç”±äºç½‘é€Ÿçš„ä¸åŒï¼Œå¯èƒ½ä½ å¾—åˆ°è¿”å›å€¼çš„æ—¶é—´ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œ</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç­‰å¾…ï¼Œç»“æœå‡ºæ¥äº†ä¹‹åæ‰çŸ¥é“æ€ä¹ˆæ ·ç»§ç»­ä¸‹å»ã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://v0.yiketianqi.com/api?unescape=1&amp;version=v61&amp;appid=82294778&amp;appsecret=4PKVFula&amp;city=%E5%8C%97%E4%BA%AC&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨ajaxçš„åŸç”Ÿå®ç°ä¸­ï¼Œåˆ©ç”¨äº†onreadystatechangeäº‹ä»¶ï¼Œå½“è¯¥äº‹ä»¶è§¦å‘å¹¶ä¸”ç¬¦åˆä¸€å®šæ¡ä»¶æ—¶ï¼Œæ‰èƒ½æ‹¿åˆ°æƒ³è¦çš„æ•°æ®ï¼Œä¹‹åæ‰èƒ½å¼€å§‹å¤„ç†æ•°æ®ï¼Œè¿™æ ·åšçœ‹ä¸Šå»å¹¶æ²¡æœ‰ä»€ä¹ˆéº»çƒ¦ï¼Œä½†å¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¦å¤–ä¸€ä¸ªajaxè¯·æ±‚ï¼Œè¿™ä¸ªæ–°ajaxè¯·æ±‚çš„å…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå¾—ä»ä¸Šä¸€ä¸ªajaxè¯·æ±‚ä¸­è·å–ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¸å¾—ä¸ç­‰å¾…ä¸Šä¸€ä¸ªæ¥å£è¯·æ±‚å®Œæˆä¹‹åï¼Œå†è¯·æ±‚åä¸€ä¸ªæ¥å£ã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://v0.yiketianqi.com/api?unescape=1&amp;version=v61&amp;appid=82294778&amp;appsecret=4PKVFula&amp;city=%E5%8C%97%E4%BA%AC&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
            
            <span class="token comment">//ä¼ªä»£ç ....</span>
            <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;http://www.xx.com?a&#39;</span><span class="token operator">+</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">&gt;=</span><span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status<span class="token operator">&lt;</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
                        
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“å‡ºç°ç¬¬ä¸‰ä¸ªajax(ç”šè‡³æ›´å¤š)ä»ç„¶ä¾èµ–ä¸Šä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬çš„ä»£ç å°±å˜æˆäº†ä¸€åœºç¾éš¾ã€‚</p><p>è¿™åœºç¾éš¾ï¼Œå¾€å¾€ä¹Ÿè¢«ç§°ä¸º<strong>å›è°ƒåœ°ç‹±</strong>ã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå«åšPromiseçš„ä¸œè¥¿ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“ç„¶ï¼Œé™¤äº†å›è°ƒåœ°ç‹±ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸ªéå¸¸é‡è¦çš„éœ€æ±‚å°±æ˜¯</p><p><strong>ä¸ºäº†ä»£ç æ›´åŠ å…·æœ‰å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®è¯·æ±‚ä¸æ•°æ®å¤„ç†æ˜ç¡®çš„åŒºåˆ†å¼€æ¥</strong>ã€‚</p><p>ä¸Šé¢çš„å†™æ³•ï¼Œæ˜¯å®Œå…¨æ²¡æœ‰åŒºåˆ†å¼€ï¼Œå½“æ•°æ®å˜å¾—å¤æ‚æ—¶ï¼Œä¹Ÿè®¸æˆ‘ä»¬è‡ªå·±éƒ½æ— æ³•è½»æ¾ç»´æŠ¤è‡ªå·±çš„ä»£ç äº†ã€‚</p><p>è¿™ä¹Ÿæ˜¯æ¨¡å—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»è¦æŒæ¡çš„ä¸€ä¸ªé‡è¦æŠ€èƒ½ï¼Œè¯·ä¸€å®šé‡è§†ã€‚</p><h3 id="äºŒã€promiseæ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#äºŒã€promiseæ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> äºŒã€Promiseæ˜¯ä»€ä¹ˆ?</h3><blockquote><p>Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆå›è°ƒå‡½æ•°æ›´åˆç†ã€æ›´å¼ºå¤§ã€‚</p><p>ES6å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº†Promiseå¯¹è±¡ã€‚</p><p>æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼ä¹Ÿå˜å¾—æ›´åŠ çµæ´»æ˜“æ‡‚ï¼Œä¹Ÿè§£å†³äº†å¼‚æ­¥<code>å›è°ƒåœ°ç‹±</code>çš„é—®é¢˜</p><p>æ—§æ–¹æ¡ˆæ˜¯å•çº¯ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œå¸¸è§çš„å¼‚æ­¥æ“ä½œæœ‰ï¼šå®šæ—¶å™¨ã€fsæ¨¡å—ã€ajaxã€æ•°æ®åº“æ“ä½œ</p><p>ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromiseæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼›</p><p>ä»åŠŸèƒ½ä¸Šè¯´ï¼ŒPromiseå¯¹è±¡ç”¨æ¥å°è£…ä¸€ä¸ªå¼‚æ­¥æ“ä½œå¹¶å¯ä»¥è·å–å…¶æˆåŠŸ/å¤±è´¥çš„ç»“æœå€¼ã€‚</p></blockquote><h4 id="_2-1-promiseçš„åˆä½“éªŒ" tabindex="-1"><a class="header-anchor" href="#_2-1-promiseçš„åˆä½“éªŒ" aria-hidden="true">#</a> 2.1 Promiseçš„åˆä½“éªŒ</h4><p>åˆ›å»ºpromiseå¯¹è±¡ï¼ˆpendingçŠ¶æ€ï¼‰</p><p>const p = new Promise(executor);</p><p>å…¶ä¸­ï¼š</p><p>executorå‡½æ•°: æ‰§è¡Œå™¨ (resolve, reject) =&gt; {}</p><p>resolveå‡½æ•°: å†…éƒ¨å®šä¹‰æˆåŠŸæ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•° value =&gt; {}</p><p>rejectå‡½æ•°: å†…éƒ¨å®šä¹‰å¤±è´¥æ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•° reason =&gt; {}</p><p>executorä¼šåœ¨Promiseå†…éƒ¨ç«‹å³åŒæ­¥è°ƒç”¨,å¼‚æ­¥æ“ä½œåœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œ</p><p>å®ä¾‹å¯¹è±¡è°ƒç”¨PromiseåŸå‹ä¸­çš„thenæ–¹æ³•æ¥å®Œæˆå¯¹ç»“æœçš„å¤„ç†</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¦‚æœå’±ä»¬å…¬å¸ä»Šå¹´æŒ£é’±äº†ï¼Œå¹´åº•å°±å‘å¥–é‡‘ï¼Œå¦åˆ™ä¸å‘</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å‘å¥–é‡‘&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸å‘å¥–é‡‘&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="ä¸‰ã€ä½¿ç”¨promiseçš„å¥½å¤„" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ä½¿ç”¨promiseçš„å¥½å¤„" aria-hidden="true">#</a> ä¸‰ã€ä½¿ç”¨Promiseçš„å¥½å¤„?</h3><h4 id="_3-1-æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼æ›´åŠ çµæ´»" tabindex="-1"><a class="header-anchor" href="#_3-1-æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼æ›´åŠ çµæ´»" aria-hidden="true">#</a> 3.1 æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼æ›´åŠ çµæ´»</h4><ol><li><p>æ—§çš„ï¼šå¿…é¡»åœ¨å¯åŠ¨å¼‚æ­¥ä»»åŠ¡å‰æŒ‡å®š</p></li><li><p>promiseï¼šå¯åŠ¨å¼‚æ­¥ä»»åŠ¡-&gt;è¿”å›promiseå¯¹è±¡-&gt;ç»™promiseå¯¹è±¡ç»‘å®šå›è°ƒå‡½æ•°</p><p>(ç”šè‡³å¯ä»¥åœ¨å¼‚æ­¥ä»»åŠ¡ç»“æŸåæŒ‡å®š/å¤šä¸ª)</p></li></ol><h4 id="_3-2-å¯ä»¥è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜-æ”¯æŒé“¾å¼è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_3-2-å¯ä»¥è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜-æ”¯æŒé“¾å¼è°ƒç”¨" aria-hidden="true">#</a> 3.2 å¯ä»¥è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨</h4><ol><li><p>ä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±ï¼Ÿ</p><p>å›è°ƒå‡½æ•°åµŒå¥—è°ƒç”¨ï¼Œå¤–éƒ¨å›è°ƒå‡½æ•°å¼‚æ­¥æ‰§è¡Œçš„ç»“æœæ˜¯åµŒå¥—çš„å›è°ƒæ‰§è¡Œçš„æ¡ä»¶</p></li><li><p>å›è°ƒåœ°ç‹±çš„ç¼ºç‚¹?</p><p>ä¸ä¾¿äºé˜…è¯»</p><p>ä¸ä¾¿äºå¼‚å¸¸å¤„ç†</p></li><li><p>è§£å†³æ–¹æ¡ˆï¼Ÿ</p><p>promiseé“¾å¼è°ƒç”¨</p></li><li><p>ç»ˆæè§£å†³æ–¹æ¡ˆï¼Ÿ</p><p>async/await</p></li></ol><h3 id="å››ã€promiseå®ä¾‹å¯¹è±¡çš„ä¸¤ä¸ªå±æ€§" tabindex="-1"><a class="header-anchor" href="#å››ã€promiseå®ä¾‹å¯¹è±¡çš„ä¸¤ä¸ªå±æ€§" aria-hidden="true">#</a> å››ã€Promiseå®ä¾‹å¯¹è±¡çš„ä¸¤ä¸ªå±æ€§</h3><ul><li><p>PromiseState</p><p>æ­¤å±æ€§ä¸ºpromiseå¯¹è±¡çš„çŠ¶æ€å±æ€§ã€‚</p><ul><li>fulfilledï¼šæˆåŠŸçš„çŠ¶æ€</li><li>rejectedï¼šå¤±è´¥çš„çŠ¶æ€</li><li>pendingï¼šåˆå§‹åŒ–çš„çŠ¶æ€</li></ul><p>ã€æ³¨ã€‘çŠ¶æ€åªèƒ½ç”±pending-&gt;fulfilled æˆ–è€…æ˜¯ pending-&gt;rejected</p></li><li><p>PromiseResult</p><p>æ­¤å±æ€§ä¸ºpromiseå¯¹è±¡çš„ç»“æœå€¼ï¼ˆresolveä»¥åŠrejectå‡½æ•°çš„å½¢å‚å€¼ï¼‰</p></li></ul><h3 id="äº”ã€resolveå‡½æ•°ä»¥åŠrejectå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#äº”ã€resolveå‡½æ•°ä»¥åŠrejectå‡½æ•°" aria-hidden="true">#</a> äº”ã€resolveå‡½æ•°ä»¥åŠrejectå‡½æ•°</h3><ul><li>resolveï¼šä¿®æ”¹promiseå¯¹è±¡çš„çŠ¶æ€ï¼Œç”±pendingä¿®æ”¹åˆ°fulfilledï¼›å°†å®å‚è®¾ç½®åˆ°è¿™ä¸ªå±æ€§PromiseResultä¸­ã€‚</li><li>rejectï¼šä¿®æ”¹promiseå¯¹è±¡çš„çŠ¶æ€ï¼Œç”±pendingä¿®æ”¹åˆ°rejectedï¼›å°†å®å‚è®¾ç½®åˆ°è¿™ä¸ªå±æ€§PromiseResultä¸­ã€‚</li></ul><p>æ¡ˆä¾‹1ï¼šåˆ©ç”¨promiseæ¥è¿›è¡Œè¯»å–æ–‡ä»¶æ“ä½œ</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//1.æ™®é€šæ–‡ä»¶è¯»å–æ–¹å¼</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2.ç›´æ¥åˆ©ç”¨readfileæ¥è¿›è¡Œè¯»å–</span>
<span class="token comment">/* fs.readFile(__dirname + &#39;/data.txt&#39;,(err,data)=&gt;{
    if(err) throw err;
    console.log(data.toString());
}) */</span>

<span class="token comment">//3.åˆ©ç”¨promiseæ¥å®ç°æ–‡ä»¶çš„è¯»å–</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&#39;/data.txt&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æ¡ˆä¾‹2ï¼šåˆ©ç”¨promiseè¿›è¡Œajaxè¯·æ±‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>å‘é€ajaxè¯·æ±‚<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token comment">//1.è·å–DOMå…ƒç´ å¯¹è±¡</span>
        <span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.ç»‘å®šäº‹ä»¶</span>
        btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//3.åˆ›å»ºpromiseå®ä¾‹å¯¹è±¡</span>
            <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">//4.åˆ›å»ºajaxå®ä¾‹å¯¹è±¡</span>
                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//5.æ‰“å¼€è¯·æ±‚</span>
                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;https://www.yiketianqi.com/free/day?appid=82294778&amp;appsecret=4PKVFula&amp;unescape=1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//6.å‘é€è¯·æ±‚</span>
                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//7.åˆ©ç”¨onreadystatechangeäº‹ä»¶</span>
                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//8.åˆ¤æ–­</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;è·å–ä¿¡æ¯å¤±è´¥&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><p>æ¡ˆä¾‹3ï¼šåˆ©ç”¨promiseè¿›è¡Œæ•°æ®åº“æ“ä½œ</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://127.0.0.1/project&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">//è¿æ¥æˆåŠŸçš„æƒ…å†µ</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//è¿æ¥å¤±è´¥çš„æƒ…å†µ</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ›å»ºç»“æ„</span>
    <span class="token keyword">const</span> NoteSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//åˆ›å»ºæ¨¡å‹</span>
    <span class="token keyword">const</span> NoteModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;notes&#39;</span><span class="token punctuation">,</span> NoteSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//è¯»å–æ“ä½œ</span>
    NoteModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;è¿æ¥å¤±è´¥&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æ¡ˆä¾‹4ï¼šå°è£…ä¸€ä¸ªå‡½æ•°ï¼Œä½œç”¨æ˜¯è¯»å–æ–‡ä»¶</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ReadFileFun</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
              <span class="token comment">//åˆ¤æ–­</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">ReadFileFun</span><span class="token punctuation">(</span><span class="token string">&#39;./data.txt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>nodeä¸­çš„promisify</p><ul><li>promisify (åªèƒ½åœ¨ NodeJS ç¯å¢ƒä¸­ä½¿ç”¨)</li><li>promisify æ˜¯ util æ¨¡å—ä¸­çš„ä¸€ä¸ªæ–¹æ³• util æ˜¯ nodeJS çš„å†…ç½®æ¨¡å—</li><li>ä½œç”¨: è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°, å‡½æ•°çš„æ˜¯ promise é£æ ¼çš„.</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;util&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//é€šè¿‡ fs.readFile åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°</span>
<span class="token keyword">const</span> mineReadFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/2.html&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å…­ã€promiseå¯¹è±¡çš„çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#å…­ã€promiseå¯¹è±¡çš„çŠ¶æ€" aria-hidden="true">#</a> å…­ã€Promiseå¯¹è±¡çš„çŠ¶æ€</h3><p>Promiseå¯¹è±¡é€šè¿‡è‡ªèº«çš„çŠ¶æ€æ¥æ§åˆ¶å¼‚æ­¥æ“ä½œï¼ŒPromiseå®ä¾‹å…·æœ‰ä¸‰ç§çŠ¶æ€.</p><ul><li>å¼‚æ­¥æ“ä½œæœªå®Œæˆï¼špending</li><li>å¼‚æ­¥æ“ä½œæˆåŠŸï¼šfulfilled</li><li>å¼‚æ­¥æ“ä½œå¤±è´¥ï¼šrejected</li></ul><p>è¿™ä¸‰ç§çš„çŠ¶æ€çš„å˜åŒ–é€”å¾„åªæœ‰ä¸¤ç§</p><ul><li>ä»pending(æœªå®Œæˆ)åˆ°fulfilled(æˆåŠŸ)</li><li>ä»pending(æœªæˆåŠŸ)åˆ°rejected(å¤±è´¥)</li></ul><p>ä¸€æ—¦çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå°±å‡å›ºäº†ï¼Œä¸ä¼šå†æœ‰æ–°çš„çŠ¶æ€å˜åŒ–ï¼Œè¿™ä¹Ÿæ˜¯Promiseè¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€&quot;æ‰¿è¯º&quot;ï¼Œ</p><p>ä¸€æ—¦æ‰¿è¯ºç”Ÿæ•ˆï¼Œå°±ä¸å¾—å†æ”¹å˜äº†ï¼Œè¿™ä¹Ÿæ„å‘³ç€Promiseå®ä¾‹çš„çŠ¶æ€å˜åŒ–åªå¯èƒ½å‘ç”Ÿä¸€æ¬¡ã€‚</p><p>åœ¨Promiseå¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­ï¼Œå°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚è€Œè¿™ä¸ªå‡½æ•°ï¼Œå°±æ˜¯ç”¨æ¥å¤„ç†Promiseçš„çŠ¶æ€å˜åŒ–ã€‚</p><p>ä¸Šé¢çš„resolveå’Œrejectéƒ½ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œä»–ä»¬çš„ä½œç”¨åˆ†åˆ«æ˜¯å°†çŠ¶æ€ä¿®æ”¹ä¸ºresolvedå’Œrejectedã€‚</p><p>å› æ­¤ï¼ŒPromiseçš„æœ€ç»ˆç»“æœåªæœ‰ä¸¤ç§ã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token function">å¼‚æ­¥æ“ä½œæˆåŠŸï¼ŒPromiseå®ä¾‹ä¼ å›ä¸€ä¸ªå€¼</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>ï¼ŒçŠ¶æ€å˜ä¸ºfulfilled<span class="token punctuation">.</span>
<span class="token function">å¼‚æ­¥æ“ä½œå¤±è´¥ï¼ŒPromiseå®ä¾‹æŠ›å‡ºä¸€ä¸ªé”™è¯¯</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">,</span>çŠ¶æ€å˜ä¸ºrejected
</code></pre></div><h3 id="ä¸ƒã€promiseçš„thenæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€promiseçš„thenæ–¹æ³•" aria-hidden="true">#</a> ä¸ƒã€Promiseçš„thenæ–¹æ³•</h3><p>thenï¼šæŒ‡å®šç”¨äºå¾—åˆ°æˆåŠŸvalueçš„æˆåŠŸå›è°ƒå’Œç”¨äºå¾—åˆ°å¤±è´¥reasonçš„å¤±è´¥å›è°ƒï¼Œ<code>è¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡</code></p><ul><li>æˆåŠŸçš„çŠ¶æ€ï¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°</li><li>å¤±è´¥çš„çŠ¶æ€ï¼šæ‰§è¡Œç¬¬äºŒä¸ªå›è°ƒå‡½æ•°</li></ul><p>promise.then()è¿”å›çš„æ–°promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®š?</p><p>(1) ç®€å•è¡¨è¾¾: ç”±then()æŒ‡å®šçš„å›è°ƒå‡½æ•°æ‰§è¡Œçš„ç»“æœå†³å®š</p><p>(2) è¯¦ç»†è¡¨è¾¾:</p><p>â‘  å¦‚æœæŠ›å‡ºå¼‚å¸¸, æ–°promiseå˜ä¸ºrejected, reasonä¸ºæŠ›å‡ºçš„å¼‚å¸¸</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">throw</span> <span class="token string">&#39;é”™è¯¯&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>â‘¡ å¦‚æœè¿”å›çš„æ˜¯épromiseçš„ä»»æ„å€¼, æ–°promiseå˜ä¸ºfulfilled, PromiseResultä¸ºè¿”å›çš„å€¼</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>â‘¢ å¦‚æœè¿”å›çš„æ˜¯å¦ä¸€ä¸ªæ–°promise, æ­¤promiseçš„ç»“æœå°±ä¼šæˆä¸ºæ–°promiseçš„ç»“æœ</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token comment">//resolve(&#39;111&#39;);</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å…«ã€promiseçš„é“¾å¼è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#å…«ã€promiseçš„é“¾å¼è°ƒç”¨" aria-hidden="true">#</a> å…«ã€Promiseçš„é“¾å¼è°ƒç”¨</h3><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">//resolve(&#39;ok&#39;);</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æ¡ˆä¾‹ï¼šé€šè¿‡promiseçš„é“¾å¼è°ƒç”¨æ¥è¯»å–æ–‡ä»¶</p><p>å›è°ƒåœ°ç‹±çš„æ–¹å¼ï¼š</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/1.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data1</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/1.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data2</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/1.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data3</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data1 <span class="token operator">+</span> data2 <span class="token operator">+</span> data3<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Promiseçš„å½¢å¼ï¼š</p><p>éœ€æ±‚ï¼šè¯»å–resourceä¸‹ä¸‰ä¸ªæ–‡ä»¶å†…å®¹ï¼Œå¹¶åœ¨æ§åˆ¶å°åˆå¹¶è¾“å‡º</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/1.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		 <span class="token comment">//å¦‚æœå¤±è´¥ åˆ™ä¿®æ”¹promiseå¯¹è±¡çŠ¶æ€ä¸ºå¤±è´¥</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¦‚æœæˆåŠŸ åˆ™ä¿®æ”¹promiseå¯¹è±¡çŠ¶æ€ä¸ºæˆåŠŸ</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/2.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
             <span class="token comment">//å¤±è´¥</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æˆåŠŸ</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value<span class="token punctuation">,</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/3.html&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
             <span class="token comment">//å¤±è´¥</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æˆåŠŸ</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ä¹ã€promiseä¸‹çš„å‡ ç§æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ä¹ã€promiseä¸‹çš„å‡ ç§æ–¹æ³•" aria-hidden="true">#</a> ä¹ã€Promiseä¸‹çš„å‡ ç§æ–¹æ³•</h3><h4 id="_9-1-promise-resolve" tabindex="-1"><a class="header-anchor" href="#_9-1-promise-resolve" aria-hidden="true">#</a> 9.1 Promise.resolve()</h4><p>å°†ä¸€ä¸ªæ™®é€šå€¼è½¬åŒ–ä¸ºpromiseç±»å‹çš„æ•°æ®</p><ul><li>è‹¥å‚æ•°ä¸ºépromiseå¯¹è±¡ï¼Œåˆ™è¿”å›çš„ç»“æœä¸ºæˆåŠŸçŠ¶æ€çš„promiseå¯¹è±¡</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>è‹¥å‚æ•°ä¸ºpromiseå¯¹è±¡ï¼Œå‚æ•°çš„çŠ¶æ€å†³å®šè¿”å›ç»“æœçš„çŠ¶æ€</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;success&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p4 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p4<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_9-2-promise-reject" tabindex="-1"><a class="header-anchor" href="#_9-2-promise-reject" aria-hidden="true">#</a> 9.2 Promise.reject()</h4><p>è¿”å›çš„ç»“æœ<code>å§‹ç»ˆä¸ºå¤±è´¥çš„Promiseå¯¹è±¡</code></p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_9-3-promise-catch" tabindex="-1"><a class="header-anchor" href="#_9-3-promise-catch" aria-hidden="true">#</a> 9.3 Promise.catch()</h4><p>åŠŸèƒ½æ˜¯ç”¨æ¥æŒ‡å®šå¤±è´¥çš„å›è°ƒå‡½æ•°</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">//resolve(&#39;success&#39;);</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//thenæ–¹æ³•ä¸­ä¸æ˜¯å¿…é¡»ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå¯ä»¥åªä¼ é€’æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°</span>
<span class="token comment">//ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨catchæ¥æŒ‡å®šå¤±è´¥çš„å›è°ƒå‡½æ•°</span>

<span class="token comment">//å¼‚å¸¸ï¼ˆé”™è¯¯ï¼‰ç©¿é€</span>
<span class="token comment">//å½“å¦‚æœæœ‰å¤šä¸ªéœ€è¦æ‰§è¡Œçš„æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥ä¸éœ€è¦æ¯ä¸€æ¬¡éƒ½å†™å¤±è´¥å›è°ƒï¼Œå¯ä»¥ç»Ÿä¸€æœ€ååˆ©ç”¨catch</span>
<span class="token comment">//å½“å¦‚æœpromiseå¯¹è±¡çš„çŠ¶æ€ä¸ºrejectçš„è¯ï¼Œä¼šä¸€ç›´å‘ä¸‹ç©¿é€ç›´åˆ°catchæ–¹æ³•</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_9-4-promise-all" tabindex="-1"><a class="header-anchor" href="#_9-4-promise-all" aria-hidden="true">#</a> 9.4 Promise.all()</h4><p>ä½œç”¨ï¼šé’ˆå¯¹äºå¤šä¸ªPromiseçš„å¼‚æ­¥ä»»åŠ¡è¿›è¡Œå¤„ç†</p><p>æ¥æ”¶çš„å‚æ•°ï¼špromiseæ•°ç»„</p><p>è¿”å›å€¼ï¼špromiseå¯¹è±¡ï¼ŒçŠ¶æ€ç”±<code>promiseæ•°ç»„ä¸­çš„å¯¹è±¡çŠ¶æ€</code>å†³å®š</p><ul><li>è‹¥æ¯ä¸ªå¯¹è±¡çŠ¶æ€<code>éƒ½ä¸º</code>æˆåŠŸï¼Œåˆ™è¿”å›çš„promiseå¯¹è±¡çŠ¶æ€ä¸ºæˆåŠŸï¼Œ</li></ul><p>â€‹ æˆåŠŸçš„ç»“æœå€¼ä¸º<code>æ¯ä¸ªpromiseå¯¹è±¡æˆåŠŸç»“æ„å€¼ç»„æˆçš„æ•°ç»„</code></p><ul><li>è‹¥<code>å…¶ä¸­ä¸€ä¸ªå¯¹è±¡</code>çŠ¶æ€ä¸ºå¤±è´¥ï¼Œåˆ™è¿”å›çš„promiseå¯¹è±¡çŠ¶æ€ä¸ºå¤±è´¥ï¼Œ</li></ul><p>â€‹ å¤±è´¥çš„ç»“æœå€¼ä¸º<code>å¤±è´¥çš„promiseå¯¹è±¡çš„ç»“æœå€¼</code></p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;oh yeah&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å½“æœ‰ä¸€ä¸ªajaxè¯·æ±‚ï¼Œå®ƒçš„å‚æ•°éœ€è¦å¦å¤–2ä¸ªç”šè‡³æ›´å¤šè¯·æ±‚éƒ½æœ‰è¿”å›ç»“æœä¹‹åæ‰èƒ½ç¡®å®šï¼Œ</p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ç”¨åˆ°Promise.allæ¥å¸®åŠ©æˆ‘ä»¬åº”å¯¹è¿™ä¸ªåœºæ™¯ã€‚</p><p>Promise.allæ¥æ”¶ä¸€ä¸ªPromiseå¯¹è±¡ç»„æˆçš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ</p><p>å½“è¿™ä¸ªæ•°ç»„æ‰€æœ‰çš„Promiseå¯¹è±¡çŠ¶æ€éƒ½å˜æˆresolvedæˆ–è€…rejectedçš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šå»è°ƒç”¨thenæ–¹æ³•ã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//ES6ä¸­å¯¹Promise.all()çš„ç†è§£ä»¥åŠåº”ç”¨åœºæ™¯</span>
<span class="token comment">//ç”¨äºå°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸ01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸ02&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸ03&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»æ˜¯iteratoræ¥å£</span>
<span class="token keyword">let</span> pAll <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pAll<span class="token punctuation">)</span>
<span class="token comment">//pAllçš„çŠ¶æ€æ˜¯ç”±p1,p2,p3æ¥å†³å®šï¼Œåªæœ‰å½“è¿™ä¸‰ä¸ªéƒ½ä¸ºæˆåŠŸï¼ŒpAllæ‰ä¼šä¸ºæˆåŠŸ,åä¹‹ï¼Œä½†å‡¡å…¶ä¸­ä¸€ä¸ªå¤±è´¥ç»“æœå°±æ˜¯å¤±è´¥</span>
<span class="token comment">//è¿™ä¸ªæ—¶å€™ç¬¬ä¸€ä¸ªå¤±è´¥çš„å®åŠ›çš„è¿”å›å€¼ä¼šä¼ é€’ç»™pAllçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœä½œä¸ºå‚æ•°çš„å®ä¾‹ï¼Œè‡ªå·±å®šä¹‰äº†catchæ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¸€æ—¦ä¸ºrejectedï¼Œæ˜¯ä¸ä¼šè§¦ç¢°åˆ°pAllä¸­çš„catchæ–¹æ³•</span>
pAll<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æ¡ˆä¾‹1ï¼šæ¨¡æ‹Ÿè¯·æ±‚ä¸‰ä¸ªæ¥å£ä¸­çš„æ•°æ®ï¼Œå…¨éƒ¨è¯·æ±‚æˆåŠŸåè·å–ã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getUsersList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ¨¡æ‹Ÿè¯·æ±‚ç”¨æˆ·åˆ—è¡¨æ•°æ®</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ç”¨æˆ·åˆ—è¡¨çš„æ•°æ®&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getBannersList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ¨¡æ‹Ÿè¯·æ±‚ç”¨æˆ·åˆ—è¡¨æ•°æ®</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;è½®æ’­å›¾çš„æ•°æ®&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getVideoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ¨¡æ‹Ÿè¯·æ±‚ç”¨æˆ·åˆ—è¡¨æ•°æ®</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;è§†é¢‘åˆ—è¡¨çš„æ•°æ®&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//åˆå§‹åŠ è½½çš„æ—¶å€™</span>
<span class="token keyword">function</span> <span class="token function">initLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> all <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getUsersList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getBannersList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getVideoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å–æˆåŠŸè¯·æ±‚çš„ç»“æœå€¼</span>
    all<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">initLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æ¡ˆä¾‹2ï¼šä¿®æ”¹å¤šæ–‡ä»¶è¯»å–ä»£ç </p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;util&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mywriteFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token function">mywriteFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/1.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token function">mywriteFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/2.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> three <span class="token operator">=</span> <span class="token function">mywriteFile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/3.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>one<span class="token punctuation">,</span>two<span class="token punctuation">,</span>three<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_9-5-promise-race" tabindex="-1"><a class="header-anchor" href="#_9-5-promise-race" aria-hidden="true">#</a> 9.5 Promise.race()</h4><p>Promise.race race èµ›è·‘çš„æ„æ€</p><p>å‚æ•°: promise æ•°ç»„</p><p>è¿”å›ç»“æœ: promise å¯¹è±¡</p><p>çŠ¶æ€ç”±ã€æœ€å…ˆæ”¹å˜çŠ¶æ€çš„ promiseå¯¹è±¡ã€å†³å®š</p><p>ç»“æœå€¼ç”± ã€æœ€å…ˆæ”¹å˜çŠ¶æ€çš„ promiseå¯¹è±¡ã€å†³å®š</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;success&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;oh hou&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¸Promise.allç›¸ä¼¼çš„æ˜¯ï¼ŒPromise.raceéƒ½æ˜¯ä»¥ä¸€ä¸ªPromiseå¯¹è±¡ç»„æˆçš„æ•°ç»„ä½œä¸ºå‚æ•°ã€‚</p><p>ä¸åŒçš„æ˜¯ï¼Œåªè¦å½“æ•°ç»„ä¸­çš„å…¶ä¸­ä¸€ä¸ªPromsieçŠ¶æ€å˜æˆresolvedæˆ–è€…rejectedæ—¶ï¼Œå°±å¯ä»¥è°ƒç”¨.thenæ–¹æ³•äº†ã€‚</p><p>è€Œä¼ é€’ç»™thenæ–¹æ³•çš„å€¼ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token comment">//ES6ä¸­Promise.raceçš„ç”¨æ³•ä»¥åŠä½¿ç”¨åœºæ™¯</span>
    <span class="token comment">//å°†å¤šä¸ªPromiseå®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹</span>
    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> rejct</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p1æˆåŠŸ&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> rejct</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p2æˆåŠŸ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è°ƒç”¨</span>
    <span class="token keyword">const</span> prace <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Promise.raceåŒºåˆ«äºPromise.allï¼š</span>
    <span class="token comment">//åªè¦æ˜¯å®ä¾‹ä¸­æœ‰ä¸€ä¸ªå…ˆæ”¹å˜çŠ¶æ€ï¼Œå°±ä¼šæŠŠè¿™ä¸ªå®ä¾‹çš„è¿”å›å€¼ä¼ é€’ç»™praceçš„å›è°ƒå‡½æ•°</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//ä½¿ç”¨åœºæ™¯ï¼šè¯·æ±‚è¶…æ—¶æç¤º</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;è¯·æ±‚æˆåŠŸ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;ç½‘ç»œä¸ç•…,è¯·æ±‚è¶…æ—¶&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_9-6-promise-allsettled" tabindex="-1"><a class="header-anchor" href="#_9-6-promise-allsettled" aria-hidden="true">#</a> 9.6 Promise.allSettled()</h4><p>Promise.allSettled()æ–¹æ³•ï¼Œç”¨æ¥ç¡®å®šè¦ä¸€ç»„å¼‚æ­¥æ“ä½œæ˜¯å¦éƒ½ç»“æŸäº†(ä¸ç®¡æˆåŠŸæˆ–å¤±è´¥)ã€‚</p><p>æ‰€ä»¥ï¼Œå®ƒçš„åå­—å«&quot;Settled&quot;ï¼ŒåŒ…å«äº†&quot;fufilled&quot;å’Œ&quot;rejected&quot;ä¸¤ç§æƒ…å†µ.</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
<span class="token comment">//ç±»æ¯”Promiseä¸‹çš„allæ–¹æ³•å’ŒallSettled</span>
<span class="token comment">// Promise.all([ajax(&#39;http://www.xiongmaoyouxuan.com/api/tabs&#39;),</span>
<span class="token comment">// ajax(&#39;https://m.maizuo.com/gateway?cityId=110100&amp;k=4770248&#39;)</span>
<span class="token comment">// ]).then(value =&gt; {</span>
<span class="token comment">//     console.log(value)</span>
<span class="token comment">// }).catch(error =&gt; {</span>
<span class="token comment">//     console.log(error);</span>
<span class="token comment">// })</span>

Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">&#39;http://www.xiongmaoyouxuan.com/api/tabs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">&#39;https://m.maizuo.com/gateway?cityId=110100&amp;k=4770248&#39;</span><span class="token punctuation">)</span>
                   <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(value)</span>
    <span class="token keyword">let</span> successList <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&#39;fulfilled&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>successList<span class="token punctuation">)</span>

    <span class="token keyword">let</span> errorList <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&#39;rejected&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errorList<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h4 id="_9-7-promise-any" tabindex="-1"><a class="header-anchor" href="#_9-7-promise-any" aria-hidden="true">#</a> 9.7 Promise.any()</h4><p>åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆfulfilledçŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆfulfiilledçŠ¶æ€ï¼›</p><p>å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆrejectedï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆrejectedçŠ¶æ€ã€‚</p><blockquote><p>Promise.any()è·ŸPromise.race()æ–¹æ³•å¾ˆåƒï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹ä¸åŒï¼Œ</p><p>å°±æ˜¯Promise.any()ä¸ä¼šå› ä¸ºæŸä¸ªPromiseå˜æˆrejectedçŠ¶æ€è€Œç»“æŸï¼Œ</p><p>å¿…é¡»ç­‰åˆ°æ‰€æœ‰å‚æ•°Promiseå˜æˆrejectedçŠ¶æ€æ‰ä¼šç»“æŸã€‚</p></blockquote><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;okk&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h4 id="_9-8-promise-finally" tabindex="-1"><a class="header-anchor" href="#_9-8-promise-finally" aria-hidden="true">#</a> 9.8 Promise.finally()</h4><p>finallyæ˜¯åœ¨ES9(ES2018)ä¸­æ–°å¢çš„ä¸€ä¸ªç‰¹æ€§ï¼šè¡¨ç¤ºæ— è®ºPromiseå¯¹è±¡å˜æˆfufilledè¿˜æ˜¯rejectedçŠ¶æ€ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«æ‰§è¡Œã€‚</p><p>finallyæ–¹æ³•ä¸­çš„<code>å›è°ƒå‡½æ•°</code>æ˜¯ä¸æ¥å—å‚æ•°çš„ï¼Œå› ä¸ºæ— è®ºå‰é¢æ˜¯fulfilledçŠ¶æ€è¿˜æ˜¯rejectedçŠ¶æ€ï¼Œ å®ƒéƒ½æ˜¯æ‰§è¡Œã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// resolve(&#39;ok&#39;);</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;finally&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="åã€ç»ˆæ­¢promiseé“¾æ¡" tabindex="-1"><a class="header-anchor" href="#åã€ç»ˆæ­¢promiseé“¾æ¡" aria-hidden="true">#</a> åã€ç»ˆæ­¢Promiseé“¾æ¡</h3><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//</span>
    <span class="token comment">// return false;</span>
    <span class="token comment">// throw &#39;å‡ºé”™å•¦&#39;;</span>
    <span class="token comment">//æœ‰ä¸”åªæœ‰ä¸€ç§æ–¹å¼ è¿”å›ä¸€ä¸ªpendingçŠ¶æ€çš„promiseå¯¹è±¡</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åä¸€ã€å‡ ä¸ªå…³é”®é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åä¸€ã€å‡ ä¸ªå…³é”®é—®é¢˜" aria-hidden="true">#</a> åä¸€ã€å‡ ä¸ªå…³é”®é—®é¢˜</h3><h4 id="_11-1-å¦‚ä½•ä¿®æ”¹-promise-å¯¹è±¡çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_11-1-å¦‚ä½•ä¿®æ”¹-promise-å¯¹è±¡çŠ¶æ€" aria-hidden="true">#</a> 11.1 å¦‚ä½•ä¿®æ”¹ promise å¯¹è±¡çŠ¶æ€</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token comment">//å¦‚ä½•ä¿®æ”¹ promise å¯¹è±¡çŠ¶æ€</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. resolve</span>
        <span class="token comment">// resolve(&#39;success&#39;);</span>
        <span class="token comment">//2. reject</span>
        <span class="token comment">// reject(&#39;error&#39;);</span>
        <span class="token comment">//3. æŠ›å‡ºé”™è¯¯ å¼‚å¸¸</span>
        <span class="token comment">// throw &#39;å‡ºé—®é¢˜å•¦! ä½ è¯´å‡ºè¿™æ ·çš„è¯  ä½ æ²¡æœ‰è‰¯å¿ƒ!!&#39;;</span>
        <span class="token comment">// çŠ¶æ€çš„æ”¹å˜åªæœ‰ä¸€æ¬¡ </span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h4 id="_11-2-æŒ‡å®šå¤šä¸ªå›è°ƒæ‰§è¡Œæƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#_11-2-æŒ‡å®šå¤šä¸ªå›è°ƒæ‰§è¡Œæƒ…å†µ" aria-hidden="true">#</a> 11.2 æŒ‡å®šå¤šä¸ªå›è°ƒæ‰§è¡Œæƒ…å†µ</h4><p>é—®é¢˜ï¼šä¸€ä¸ªpromiseæŒ‡å®šå¤šä¸ªæˆåŠŸ/å¤±è´¥å›è°ƒå‡½æ•°ï¼Œéƒ½ä¼šè°ƒç”¨å—ï¼Ÿ</p><p>ç­”ï¼šä¼šï¼Œä½†æ˜¯å‰ææ˜¯å½“promiseå¯¹è±¡çš„çŠ¶æ€æ”¹å˜(fulfilled/rejected)æ—¶æ‰ä¼šè°ƒç”¨</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//promiseå¯¹è±¡æ˜¯å¯ä»¥å¤šæ¬¡è°ƒç”¨thenæ–¹æ³•å®Œæˆå¤šä¸ªæˆåŠŸ/å¤±è´¥å›è°ƒå‡½æ•°</span>
            <span class="token comment">//ä½†æ˜¯ä½¿ç”¨çš„å‰ææ˜¯è¿™ä¸ªpromiseå¯¹è±¡çš„çŠ¶æ€å¿…é¡»è¦ä¹ˆæ˜¯fulfilledæˆ–è€…æ˜¯rejected</span>
            <span class="token comment">//ä¸èƒ½æ˜¯pending</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;OK&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		
        <span class="token comment">//ç¬¬ä¸€æ¬¡æŒ‡å®šå›è°ƒ</span>
        p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h4 id="_11-3-æŒ‡å®šå›è°ƒä¸æ”¹å˜çŠ¶æ€å…ˆåé¡ºåºé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_11-3-æŒ‡å®šå›è°ƒä¸æ”¹å˜çŠ¶æ€å…ˆåé¡ºåºé—®é¢˜" aria-hidden="true">#</a> 11.3 æŒ‡å®šå›è°ƒä¸æ”¹å˜çŠ¶æ€å…ˆåé¡ºåºé—®é¢˜</h4><p>æ”¹å˜promiseçŠ¶æ€å’ŒæŒ‡å®šå›è°ƒå‡½æ•°æ‰§è¡Œè°å…ˆè°åï¼Ÿ</p><ul><li><p>éƒ½æœ‰å¯èƒ½ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯å…ˆæŒ‡å®šå›è°ƒå†æ”¹å˜çŠ¶æ€ï¼Œä½†ä¹Ÿå¯ä»¥å…ˆæ”¹å˜çŠ¶æ€åœ¨æŒ‡å®šå›è°ƒ</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//è‹¥æ‰§è¡Œå™¨å‡½æ•°ä¸­æ˜¯å¼‚æ­¥ä»»åŠ¡, åˆ™å…ˆæŒ‡å®šå›è°ƒ, ç„¶åå†æ”¹å˜çŠ¶æ€  æ›´ä¸ºå¸¸è§</span>
<span class="token comment">//è‹¥æ‰§è¡Œå™¨å‡½æ•°ä¸­æ˜¯åŒæ­¥ä»»åŠ¡, åˆ™å…ˆæ”¹å˜çŠ¶æ€, ç„¶åå†æŒ‡å®šå›è°ƒ</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//åŒæ­¥ä»»åŠ¡</span>
    <span class="token comment">//resolve(&#39;ok&#39;);</span>
    <span class="token comment">//å¼‚æ­¥ä»»åŠ¡</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>å¦‚ä½•å…ˆæ”¹çŠ¶æ€å†æŒ‡å®šå›è°ƒï¼Ÿ</p><ul><li>åœ¨æ‰§è¡Œå™¨ä¸­ç›´æ¥è°ƒç”¨resolve()/reject()</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">//resolve(&#39;ok&#39;);</span>
	<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>å»¶è¿Ÿæ›´é•¿æ—¶é—´æ‰è°ƒç”¨then()</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//thenæ–¹æ³•ä½¿ç”¨å®šæ—¶å™¨å»¶è¿Ÿæ›´ä¹…çš„æ—¶é—´</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>ä»€ä¹ˆæ—¶å€™æ‰èƒ½å¾—åˆ°æ•°æ®ï¼Ÿ</p><ul><li>å¦‚æœæ˜¯å…ˆæŒ‡å®šçš„å›è°ƒï¼Œé‚£å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå›è°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®</li><li>å¦‚æœå…ˆæ”¹å˜çš„çŠ¶æ€ï¼Œé‚£å½“æŒ‡å®šå›è°ƒæ—¶ï¼Œå›è°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®</li></ul></li></ul><h4 id="_11-4-promise-then-è¿”å›çš„æ–°promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®š" tabindex="-1"><a class="header-anchor" href="#_11-4-promise-then-è¿”å›çš„æ–°promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®š" aria-hidden="true">#</a> 11.4 promise.then()è¿”å›çš„æ–°promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®šï¼Ÿ</h4><ul><li>ç®€å•è¡¨è¾¾ï¼šç”±thenæŒ‡å®šçš„å›è°ƒå‡½æ•°æ‰§è¡Œçš„ç»“æœå†³å®š</li><li>è¯¦ç»†è¡¨è¾¾ï¼š <ul><li>å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼šæ–°promiseå¯¹è±¡çŠ¶æ€å˜æˆrejectedï¼Œreasonä¸ºæŠ›å‡ºçš„å¼‚å¸¸</li><li>å¦‚æœè¿”å›çš„æ˜¯æ˜¯épromiseçš„ä»»æ„å€¼ï¼Œæ–°promiseå¯¹è±¡çŠ¶æ€å˜æˆfulfilledï¼Œvalueä¸ºè¿”å›çš„å€¼</li><li>å¦‚æœè¿”å›çš„æ˜¯å¦ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ï¼Œæ­¤promiseçš„ç»“æœå°±ä¼šç§°ä¸ºæ–°promiseçš„ç»“æœ</li></ul></li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//return value;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;okk&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_11-5-promiseå¦‚ä½•ä¸²è”å¤šä¸ªæ“ä½œä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_11-5-promiseå¦‚ä½•ä¸²è”å¤šä¸ªæ“ä½œä»»åŠ¡" aria-hidden="true">#</a> 11.5 promiseå¦‚ä½•ä¸²è”å¤šä¸ªæ“ä½œä»»åŠ¡?</h4><ul><li>promiseçš„then()è¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ï¼Œå¯ä»¥å†™æˆthen()æ–¹æ³•çš„é“¾å¼è°ƒç”¨</li><li>é€šè¿‡then()çš„é“¾å¼è°ƒç”¨ä¸²è”å¤šä¸ªåŒæ­¥/å¼‚æ­¥ä»»åŠ¡</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h4 id="_11-6-promiseçš„å¼‚å¸¸ç©¿é€" tabindex="-1"><a class="header-anchor" href="#_11-6-promiseçš„å¼‚å¸¸ç©¿é€" aria-hidden="true">#</a> 11.6 promiseçš„å¼‚å¸¸ç©¿é€</h4><ul><li>å½“ä½¿ç”¨promiseçš„thené“¾å¼è°ƒç”¨æ—¶, å¯ä»¥åœ¨æœ€åæŒ‡å®šå¤±è´¥çš„å›è°ƒ,</li><li>å‰é¢ä»»ä½•æ“ä½œå‡ºäº†å¼‚å¸¸, éƒ½ä¼šä¼ åˆ°æœ€åå¤±è´¥çš„å›è°ƒä¸­å¤„ç†</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_11-7-ä¸­æ–­promiseé“¾" tabindex="-1"><a class="header-anchor" href="#_11-7-ä¸­æ–­promiseé“¾" aria-hidden="true">#</a> 11.7 ä¸­æ–­promiseé“¾</h4><ul><li>å½“ä½¿ç”¨promiseçš„thené“¾å¼è°ƒç”¨æ—¶, åœ¨ä¸­é—´ä¸­æ–­, ä¸å†è°ƒç”¨åé¢çš„å›è°ƒå‡½æ•°</li><li>åŠæ³•: åœ¨å›è°ƒå‡½æ•°ä¸­è¿”å›ä¸€ä¸ªpendingçŠ¶æ€çš„promiseå¯¹è±¡</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åäºŒã€asyncå’Œawait" tabindex="-1"><a class="header-anchor" href="#åäºŒã€asyncå’Œawait" aria-hidden="true">#</a> åäºŒã€asyncå’Œawait</h3><p>async/await æ˜¯ES7æå‡ºçš„åŸºäºPromiseçš„è§£å†³å¼‚æ­¥çš„æœ€ç»ˆæ–¹æ¡ˆã€‚</p><h4 id="_12-1-asyncå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_12-1-asyncå‡½æ•°" aria-hidden="true">#</a> 12.1 asyncå‡½æ•°</h4><p>asyncæ˜¯ä¸€ä¸ªåŠ åœ¨å‡½æ•°å‰çš„ä¿®é¥°ç¬¦ï¼Œè¢«asyncå®šä¹‰çš„å‡½æ•°ä¼šé»˜è®¤è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡resolveçš„å€¼ã€‚</p><p>å› æ­¤å¯¹asyncå‡½æ•°å¯ä»¥ç›´æ¥thenï¼Œè¿”å›å€¼å°±æ˜¯thenæ–¹æ³•ä¼ å…¥çš„å‡½æ•°ã€‚</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// asyncåŸºç¡€è¯­æ³•</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fun0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fun0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">// 1,1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Promise&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;Promise&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise Promise</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//å£°æ˜ä¸€ä¸ªasyncå‡½æ•°</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;async function&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æƒ…å†µ1ï¼šè¿”å›épromiseå¯¹è±¡æ•°æ®</span>
    <span class="token keyword">return</span> <span class="token string">&#39;hahaha&#39;</span><span class="token punctuation">;</span>
    <span class="token comment">//æƒ…å†µ2ï¼šè¿”å›æ˜¯promiseå¯¹è±¡æ•°æ®</span>
    <span class="token comment">/* return new Promise((resolve, reject) =&gt; {
		// resolve(&#39;ok&#39;);
		reject(&#39;error&#39;);
	}) */</span>
    <span class="token comment">//æƒ…å†µ3ï¼šæŠ›å‡ºå¼‚å¸¸</span>
    <span class="token comment">// throw new Error(&#39;å‡ºé”™å•¦!!!&#39;);</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_12-2-awaitè¡¨è¾¾å¼" tabindex="-1"><a class="header-anchor" href="#_12-2-awaitè¡¨è¾¾å¼" aria-hidden="true">#</a> 12.2 awaitè¡¨è¾¾å¼</h4><p>await ä¹Ÿæ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œåªèƒ½æ”¾åœ¨asyncå®šä¹‰çš„å‡½æ•°å†…ã€‚å¯ä»¥ç†è§£ä¸º<strong>ç­‰å¾…</strong>ã€‚</p><p>await ä¿®é¥°çš„å¦‚æœæ˜¯Promiseå¯¹è±¡ï¼Œå¯ä»¥è·å–Promiseä¸­è¿”å›çš„å†…å®¹ï¼ˆresolveæˆ–rejectçš„å‚æ•°ï¼‰ï¼Œä¸”å–åˆ°å€¼åè¯­</p><p>å¥æ‰ä¼šå¾€ä¸‹æ‰§è¡Œï¼›å¦‚æœä¸æ˜¯Promiseå¯¹è±¡ï¼šæŠŠè¿™ä¸ªépromiseçš„ä¸œè¥¿å½“åšawaitè¡¨è¾¾å¼çš„ç»“æœã€‚</p><p>æ³¨æ„äº‹é¡¹</p><ul><li>awaitå¿…é¡»å†™åœ¨asyncå‡½æ•°ä¸­ï¼Œä½†æ˜¯asyncå‡½æ•°ä¸­å¯ä»¥æ²¡æœ‰await</li><li>å¦‚æœawaitçš„promiseå¤±è´¥äº†ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦é€šè¿‡try...catchæ•è·å¤„ç†</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;setTimeout&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&#39;function&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3ç§’åè¾“å‡ºï¼š 1 &quot;setTimeout&quot; &quot;function&quot;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>time<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// ç«‹å³è¾“å‡º undefined 1</span>
<span class="token comment">// 1ç§’åè¾“å‡º 1000</span>
<span class="token comment">// 2ç§’åè¾“å‡º 2000</span>
<span class="token comment">// 3ç§’åè¾“å‡º 3000</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1ã€å¦‚æœawaitå³ä¾§ä¸ºépromiseç±»å‹æ•°æ®</span>
    <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token string">&quot;éå¸¸6+7&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//2ã€å¦‚æœawaitå³ä¾§ä¸ºpromiseæˆåŠŸç±»å‹æ•°æ®</span>
    <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;success&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//3ã€å¦‚æœawaitå³ä¾§ä¸ºpromiseå¤±è´¥ç±»å‹æ•°æ®,éœ€è¦å€ŸåŠ©äºtry...catchæ•è·</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ä½¿ç”¨async/awaitè·å–æˆåŠŸçš„ç»“æœ</span>

<span class="token comment">// å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œ3ç§’åæ‰èƒ½è·å–åˆ°å€¼(ç±»ä¼¼æ“ä½œæ•°æ®åº“)</span>
<span class="token keyword">function</span> <span class="token function">getSomeThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;è·å–æˆåŠŸ&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSomeThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3ç§’åè¾“å‡ºï¼šè·å–æˆåŠŸ</span>
</code></pre></div><p>æ¡ˆä¾‹ï¼šasyncç»“åˆawaitè¯»å–æ–‡ä»¶å†…å®¹</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//1ã€å¯¼åŒ…</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>promisify<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;util&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2ã€å°†fs.readFileè½¬åŒ–æˆpromiseé£æ ¼çš„å‡½æ•°</span>
<span class="token keyword">const</span> myreadfile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//3ã€å£°æ˜asyncå‡½æ•°</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token comment">//4ã€è¯»å–æ–‡ä»¶</span>
        <span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myreadfile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/4.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myreadfile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/2.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> three <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myreadfile</span><span class="token punctuation">(</span><span class="token string">&#39;./resource/3.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5ã€æ‹¼æ¥è¯»å–æ–‡ä»¶å†…å®¹</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>one <span class="token operator">+</span> two <span class="token operator">+</span> three<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//6ã€è°ƒç”¨mainå‡½æ•°</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åä¸‰ã€jsä¸­çš„å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#åä¸‰ã€jsä¸­çš„å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ—" aria-hidden="true">#</a> åä¸‰ã€JSä¸­çš„å®é˜Ÿåˆ—ä¸å¾®é˜Ÿåˆ—</h3><ul><li>è¯´æ˜ <ul><li>JSä¸­ç”¨æ¥å­˜å‚¨å¾…æ‰§è¡Œå›è°ƒå‡½æ•°çš„é˜Ÿåˆ—åŒ…å«2ä¸ªä¸åŒç‰¹å®šçš„åˆ—é˜Ÿ</li><li>å®åˆ—é˜Ÿ: ç”¨æ¥ä¿å­˜å¾…æ‰§è¡Œçš„å®ä»»åŠ¡(å›è°ƒ), æ¯”å¦‚: å®šæ—¶å™¨å›è°ƒ/DOMäº‹ä»¶å›è°ƒ/ajaxå›è°ƒ</li><li>å¾®åˆ—é˜Ÿ: ç”¨æ¥ä¿å­˜å¾…æ‰§è¡Œçš„å¾®ä»»åŠ¡(å›è°ƒ), æ¯”å¦‚: promiseçš„å›è°ƒ/MutationObserverçš„å›è°ƒ</li><li>JSæ‰§è¡Œæ—¶ä¼šåŒºåˆ«è¿™2ä¸ªé˜Ÿåˆ— <ul><li>JSå¼•æ“é¦–å…ˆå¿…é¡»å…ˆæ‰§è¡Œæ‰€æœ‰çš„åˆå§‹åŒ–åŒæ­¥ä»»åŠ¡ä»£ç </li><li>æ¯æ¬¡å‡†å¤‡å–å‡ºç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå‰, éƒ½è¦å°†æ‰€æœ‰çš„å¾®ä»»åŠ¡ä¸€ä¸ªä¸€ä¸ªå–å‡ºæ¥æ‰§è¡Œ</li></ul></li></ul></li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//return ;throw</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åå››ã€promiseå¸¸è§é¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#åå››ã€promiseå¸¸è§é¢è¯•é¢˜" aria-hidden="true">#</a> åå››ã€Promiseå¸¸è§é¢è¯•é¢˜</h3><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">first</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;8&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åäº”ã€æ‰‹å†™promiseè‡ªå®šä¹‰åŸºç¡€ç»“æ„çš„æ­å»º" tabindex="-1"><a class="header-anchor" href="#åäº”ã€æ‰‹å†™promiseè‡ªå®šä¹‰åŸºç¡€ç»“æ„çš„æ­å»º" aria-hidden="true">#</a> åäº”ã€æ‰‹å†™promiseè‡ªå®šä¹‰åŸºç¡€ç»“æ„çš„æ­å»º</h3><h4 id="_15-1-promise-çš„åŸºæœ¬ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_15-1-promise-çš„åŸºæœ¬ç»“æ„" aria-hidden="true">#</a> 15.1 Promise çš„åŸºæœ¬ç»“æ„</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 1- Promise æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°
 * 2- Promise æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°çš„ç±»å‹æ˜¯å‡½æ•°ï¼ˆæ‰§è¡Œå™¨å‡½æ•°executorï¼‰
 * 3- executoræ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆresolve,rejectï¼‰,å‚æ•°çš„ç±»å‹æ˜¯å‡½æ•°
 * 4- æ‰§è¡Œå™¨å‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œã€‚
 * 5- thenæ–¹æ³•åœ¨å…¶æ˜¾å¼åŸå‹å±æ€§ä¸Š
 */</span>

<span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
    <span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;è¿™æ˜¯æˆ‘çš„æ‰§è¡Œå™¨å‡½æ•°&quot;</span><span class="token punctuation">,</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;over&quot;</span><span class="token punctuation">,</span>Promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-2-promiseå®ä¾‹æ‹¥æœ‰ä¸¤ä¸ªå®ä¾‹å±æ€§" tabindex="-1"><a class="header-anchor" href="#_15-2-promiseå®ä¾‹æ‹¥æœ‰ä¸¤ä¸ªå®ä¾‹å±æ€§" aria-hidden="true">#</a> 15.2 Promiseå®ä¾‹æ‹¥æœ‰ä¸¤ä¸ªå®ä¾‹å±æ€§</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
 * 1- Promiseå®ä¾‹æ‹¥æœ‰ä¸¤ä¸ªå®ä¾‹å±æ€§ï¼š
 * çŠ¶æ€ï¼ˆ[[PromiseState]]ï¼‰ï¼Œåˆå§‹çŠ¶æ€ä¸ºpending
 * å€¼ï¼ˆ[[PromiseResult]]ï¼‰,åˆå§‹å€¼ä¸ºundefined
*/</span> 
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;è¿™æ˜¯æˆ‘çš„æ‰§è¡Œå™¨å‡½æ•°&quot;</span><span class="token punctuation">,</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-3-æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æ–¹æ³•æœªæŠ½ç¦»" tabindex="-1"><a class="header-anchor" href="#_15-3-æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æ–¹æ³•æœªæŠ½ç¦»" aria-hidden="true">#</a> 15.3 æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æ–¹æ³•æœªæŠ½ç¦»</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
 * æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼
 * 1- é€šè¿‡è°ƒç”¨resolveå°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸï¼ˆfulfilledï¼‰ï¼Œæ¥æ”¶çš„å€¼ä¸ºæˆåŠŸå€¼
 * 2- é€šè¿‡è°ƒç”¨rejectå°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥(rejected)ï¼Œæ¥æ”¶çš„å€¼ä¸ºå¤±è´¥å€¼
 * 3- æŠ›å‡ºå¼‚å¸¸å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥(rejected)ï¼Œå¤±è´¥çš„å€¼ä¸ºå¼‚å¸¸ä¿¡æ¯ã€‚
*/</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
				<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
				<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†å¼‚å¸¸ä¿¡æ¯ä½œä¸ºå¤±è´¥å€¼</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> err<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve(1);</span>
    <span class="token comment">// reject(2);</span>
    <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-4-æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æŠ½ç¦»ä¸ºæ™®é€šå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_15-4-æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æŠ½ç¦»ä¸ºæ™®é€šå‡½æ•°" aria-hidden="true">#</a> 15.4 æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æŠ½ç¦»ä¸ºæ™®é€šå‡½æ•°</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†å¼‚å¸¸ä¿¡æ¯ä½œä¸ºå¤±è´¥å€¼</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> err<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve(1);</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// throw &quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-5-æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æŠ½ç¦»ä¸ºç®­å¤´å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_15-5-æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æŠ½ç¦»ä¸ºç®­å¤´å‡½æ•°" aria-hidden="true">#</a> 15.5 æ›´æ”¹çŠ¶æ€ä¸‰ç§æ–¹å¼-æŠ½ç¦»ä¸ºç®­å¤´å‡½æ•°</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†å¼‚å¸¸ä¿¡æ¯ä½œä¸ºå¤±è´¥å€¼</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> err<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve(1);</span>
    <span class="token comment">// reject(2);</span>
    <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-6-çŠ¶æ€åªå…è®¸æ›´æ”¹ä¸€æ¬¡" tabindex="-1"><a class="header-anchor" href="#_15-6-çŠ¶æ€åªå…è®¸æ›´æ”¹ä¸€æ¬¡" aria-hidden="true">#</a> 15.6 çŠ¶æ€åªå…è®¸æ›´æ”¹ä¸€æ¬¡</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
 * pending-&gt; fulfilled
 * pending-&gt; rejected
 * æ”¹å˜çŠ¶æ€åªæœ‰è¿™ä¸¤ç§ï¼Œä¸”ä¸€ä¸ªpromiseå¯¹è±¡åªèƒ½æ”¹å˜ä¸€æ¬¡ï¼Œï¼Œæ— è®ºå˜æˆæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç»“æœå€¼
 * æˆåŠŸçš„ç»“æœæ•°æ®ä¸€èˆ¬ç§°ä¸ºvalueï¼Œå¤±è´¥çš„ç»“æœå€¼ä¸€èˆ¬ç§°ä¸ºreason
*/</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-7-thenå‡½æ•°è°ƒç”¨æˆåŠŸæˆ–å¤±è´¥å›è°ƒå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_15-7-thenå‡½æ•°è°ƒç”¨æˆåŠŸæˆ–å¤±è´¥å›è°ƒå‡½æ•°" aria-hidden="true">#</a> 15.7 thenå‡½æ•°è°ƒç”¨æˆåŠŸæˆ–å¤±è´¥å›è°ƒå‡½æ•°</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
 * 1- thenæ˜¯Promiseä¸­çš„åŸå‹æ–¹æ³•
 * 2- thenå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆæˆåŠŸå›è°ƒï¼Œå¤±è´¥å›è°ƒï¼‰
 * 3- å¦‚æœp1çŠ¶æ€ä¸ºæˆåŠŸæ‰§è¡ŒæˆåŠŸå›è°ƒï¼Œå¤±è´¥æ‰§è¡Œå¤±è´¥å›è°ƒã€‚
*/</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-8-thenå‡½æ•°ä¸­çš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥è°ƒç”¨çš„" tabindex="-1"><a class="header-anchor" href="#_15-8-thenå‡½æ•°ä¸­çš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥è°ƒç”¨çš„" aria-hidden="true">#</a> 15.8 thenå‡½æ•°ä¸­çš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥è°ƒç”¨çš„</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// å¼‚æ­¥è°ƒç”¨</span>
				<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// å¼‚æ­¥è°ƒç”¨</span>
				<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve(1);</span>
    <span class="token comment">// reject(2);</span>
    <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸå›è°ƒ&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¤±è´¥å›è°ƒ&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-9-thenå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªpromiseå®ä¾‹" tabindex="-1"><a class="header-anchor" href="#_15-9-thenå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªpromiseå®ä¾‹" aria-hidden="true">#</a> 15.9 thenå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå®ä¾‹</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment">// å¼‚æ­¥è°ƒç”¨</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment">// å¼‚æ­¥è°ƒç”¨</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve(1);</span>
    <span class="token comment">// reject(2);</span>
    <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸå›è°ƒ&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¤±è´¥å›è°ƒ&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-10-thenå‡½æ•°è¿”å›çš„promiseå®ä¾‹çŠ¶æ€ä»¥åŠå€¼-æœªä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_15-10-thenå‡½æ•°è¿”å›çš„promiseå®ä¾‹çŠ¶æ€ä»¥åŠå€¼-æœªä¼˜åŒ–" aria-hidden="true">#</a> 15.10 thenå‡½æ•°è¿”å›çš„Promiseå®ä¾‹çŠ¶æ€ä»¥åŠå€¼-æœªä¼˜åŒ–</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
 * thenè¿”å›çš„Promiseå®ä¾‹å—æˆåŠŸæˆ–å¤±è´¥å›è°ƒå‡½æ•°è¿”å›å€¼çš„å½±å“
 * 1- å¦‚æœè¿”å›çš„æ˜¯éPromise,é‚£ä¹ˆp2çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºè¿”å›å€¼
 * 2- å¦‚æœè¿”å›çš„æ˜¯Promise,é‚£ä¹ˆp2çŠ¶æ€ä»¥åŠå€¼ä¸è¿”å›çš„çŠ¶æ€ï¼Œå€¼ç›¸åŒã€‚
 * 3- å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆp2çŠ¶æ€ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯ã€‚
*/</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment">// å¼‚æ­¥è°ƒç”¨</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
								<span class="token comment">// value.then(v=&gt;{</span>
								<span class="token comment">// 	// å°†è¿”å›çš„Promiseå®ä¾‹è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºv</span>
								<span class="token comment">// 	resolve(v);</span>
								<span class="token comment">// },s=&gt;{</span>
								<span class="token comment">// 	// å°†è¿”å›çš„Promiseå®ä¾‹è®¾ç½®ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºs</span>
								<span class="token comment">// 	reject(s);</span>
								<span class="token comment">// })</span>
								
								<span class="token comment">// ç®€åŒ–ï¼š</span>
								value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
							<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment">// å¼‚æ­¥è°ƒç”¨</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯å¤±è´¥å›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// valueæ˜¯å¦ä¸ºPromiseå®ä¾‹</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
								<span class="token comment">// å°†è¿”å›Promiseè®¾ç½®ä¸ºä¸valueç›¸åŒçš„ç»“æœ</span>
								value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// è¿”å›æˆåŠŸpromise,å€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// è¿”å›å¤±è´¥promise,å€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve(1);</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// throw &quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// resolve(100)</span>
        <span class="token comment">// reject(200)</span>
        <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸2&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// return 1;</span>
    <span class="token comment">// console.log(&quot;æˆåŠŸå›è°ƒ&quot;,value);</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// resolve(100);</span>
        <span class="token comment">// reject(2)</span>
        <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸3&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// return 1;</span>
    <span class="token comment">// console.log(&quot;å¤±è´¥å›è°ƒ&quot;,reason);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-11-thenå‡½æ•°è¿”å›çš„promiseå®ä¾‹çŠ¶æ€ä»¥åŠå€¼-ä¼˜åŒ–å°è£…å‡½æ•°-common" tabindex="-1"><a class="header-anchor" href="#_15-11-thenå‡½æ•°è¿”å›çš„promiseå®ä¾‹çŠ¶æ€ä»¥åŠå€¼-ä¼˜åŒ–å°è£…å‡½æ•°-common" aria-hidden="true">#</a> 15.11 thenå‡½æ•°è¿”å›çš„Promiseå®ä¾‹çŠ¶æ€ä»¥åŠå€¼-ä¼˜åŒ–å°è£…å‡½æ•°_common</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
								value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve(1);</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// throw &quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// return new Promise((resolve,reject)=&gt;{</span>
    <span class="token comment">// 	// resolve(100)</span>
    <span class="token comment">// 	// reject(200)</span>
    <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸2&quot;</span>
    <span class="token comment">// })</span>
    <span class="token comment">// return 1;</span>
    <span class="token comment">// console.log(&quot;æˆåŠŸå›è°ƒ&quot;,value);</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// return new Promise((resolve,reject)=&gt;{</span>
    <span class="token comment">// 	// resolve(100);</span>
    <span class="token comment">// 	// reject(2)</span>
    <span class="token comment">// 	throw &quot;å¼‚å¸¸3&quot;</span>
    <span class="token comment">// })</span>
    <span class="token comment">// return 1;</span>
    <span class="token comment">// console.log(&quot;å¤±è´¥å›è°ƒ&quot;,reason);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-12-å¢åŠ æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°çš„é»˜è®¤å€¼" tabindex="-1"><a class="header-anchor" href="#_15-12-å¢åŠ æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°çš„é»˜è®¤å€¼" aria-hidden="true">#</a> 15.12 å¢åŠ æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°çš„é»˜è®¤å€¼</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
 * 1- thenå¦‚æœçœç•¥æˆåŠŸå›è°ƒï¼Œé»˜è®¤æˆåŠŸå›è°ƒä¸º value=&gt;value;
 * 2- thenå¦‚æœçœç•¥å¤±è´¥å›è°ƒï¼Œé»˜è®¤å¤±è´¥å›è°ƒä¸º reason=&gt;{throw reason};
*/</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç«‹å³è°ƒç”¨å‡½æ•°çš„å¥½å¤„ï¼šå¯ä»¥é¿å…å¯¹å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“ã€‚</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
								value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// reject(2);</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-14-æ‰§è¡Œå™¨å‡½æ•°å¸¸ç”¨äºå¤„ç†å¼‚æ­¥è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#_15-14-æ‰§è¡Œå™¨å‡½æ•°å¸¸ç”¨äºå¤„ç†å¼‚æ­¥è¡Œä¸º" aria-hidden="true">#</a> 15.14 æ‰§è¡Œå™¨å‡½æ•°å¸¸ç”¨äºå¤„ç†å¼‚æ­¥è¡Œä¸º</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¤±è´¥&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_15-15-å¯ä»¥æŒ‡å®šå¤šä¸ªæˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒ" tabindex="-1"><a class="header-anchor" href="#_15-15-å¯ä»¥æŒ‡å®šå¤šä¸ªæˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒ" aria-hidden="true">#</a> 15.15 å¯ä»¥æŒ‡å®šå¤šä¸ªæˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒ</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// å¯ä»¥æŒ‡å®šå¤šä¸ªæˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒ</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸ1&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¤±è´¥1&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸ2&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¤±è´¥2&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸ3&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¤±è´¥3&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸ4&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¤±è´¥4&quot;</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_15-16-catch" tabindex="-1"><a class="header-anchor" href="#_15-16-catch" aria-hidden="true">#</a> 15.16 catch</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// å¯ä»¥æŒ‡å®šå¤šä¸ªæˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒ</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// p1.then(undefined,reason=&gt;{</span>
<span class="token comment">// 	console.log(reason);</span>
<span class="token comment">// })</span>
<span class="token comment">// catchçš„è¿”å›å€¼æ˜¯Promiseå®ä¾‹,å®ä¾‹çš„å±æ€§ä¸å€¼å–å†³äºå›è°ƒå‡½æ•°çš„è¿”å›å€¼</span>
<span class="token comment">// è¿”å›å€¼ä¸ºéPromiseå®ä¾‹ï¼Œé‚£ä¹ˆå¾—åˆ°çš„çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºè¿”å›å€¼</span>
<span class="token comment">// è¿”å›å€¼ä¸ºPromiseå®ä¾‹ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœä¸è¿”å›çš„ç»“æœç›¸åŒã€‚</span>
<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œé‚£ä¹ˆå¾—åˆ°çš„çŠ¶æ€ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯ã€‚</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// console.log(reason);</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// throw &quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-17-é“¾å¼è°ƒç”¨æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#_15-17-é“¾å¼è°ƒç”¨æ”¯æŒ" aria-hidden="true">#</a> 15.17 é“¾å¼è°ƒç”¨æ”¯æŒ</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2</span>
    <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3</span>
    <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 4</span>
    <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_15-18-å¼‚å¸¸ç©¿é€æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#_15-18-å¼‚å¸¸ç©¿é€æ”¯æŒ" aria-hidden="true">#</a> 15.18 å¼‚å¸¸ç©¿é€æ”¯æŒ</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token string">&quot;å¼‚å¸¸&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3</span>
    <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 4</span>
    <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_15-19-ä¸­æ–­promiseé“¾" tabindex="-1"><a class="header-anchor" href="#_15-19-ä¸­æ–­promiseé“¾" aria-hidden="true">#</a> 15.19 ä¸­æ–­Promiseé“¾</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2</span>
    <span class="token comment">// åœ¨å›è°ƒå‡½æ•°ä¸­è¿”å›ä¸€ä¸ª`pendding`çŠ¶æ€çš„promiseå¯¹è±¡</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span>
    <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 4</span>
    <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_15-20-resolve" tabindex="-1"><a class="header-anchor" href="#_15-20-resolve" aria-hidden="true">#</a> 15.20 resolve</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	Promise<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> value<span class="token punctuation">;</span><span class="token comment">// å¦‚æœæ˜¯Promiseå®ä¾‹ç›´æ¥è¿”å›</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœä¸æ˜¯Promiseå®ä¾‹ï¼Œé‚£ä¹ˆè¿”å›çš„çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// const p1 = Promise.resolve(1);</span>
<span class="token comment">// console.log(p1);</span>

<span class="token comment">// const p1 = Promise.resolve(new Promise((resolve,reject)=&gt;{</span>
<span class="token comment">// 	resolve(2);</span>
<span class="token comment">// }));</span>
<span class="token comment">// console.log(p1);</span>
<span class="token comment">//</span>
<span class="token comment">// const p1 = Promise.resolve(new Promise((resolve,reject)=&gt;{</span>
<span class="token comment">// 	reject(2);</span>
<span class="token comment">// }));</span>
<span class="token comment">// console.log(p1);</span>


<span class="token keyword">const</span> p <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token operator">===</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-21-reject" tabindex="-1"><a class="header-anchor" href="#_15-21-reject" aria-hidden="true">#</a> 15.21 reject</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// executoræ˜¯æ‰§è¡Œå™¨å‡½æ•°</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è®°å½•æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§state,åˆå§‹å€¼ä¸ºpending</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰å®ä¾‹å±æ€§result,åˆå§‹å€¼ä¸ºundefined</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token comment">// å®šä¹‰resolveå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºæˆåŠŸ(fulfilled)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// æˆåŠŸå€¼ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å®šä¹‰rejectå‡½æ•°</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">// å½“çŠ¶æ€å·²ç»è¢«æ›´æ”¹è¿‡ï¼Œä¸å…è®¸å†æ¬¡æ›´æ”¹</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†resultè®¾ç½®ä¸ºvalue</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span><span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span>_reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>
		<span class="token comment">// onResolved:æˆåŠŸå›è°ƒ</span>
		<span class="token comment">// onRejected:å¤±è´¥å›è°ƒ</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæˆåŠŸå›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ æˆåŠŸå›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// å¦‚æœå¤±è´¥å›è°ƒä¸æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå¢åŠ å¤±è´¥å›è°ƒé»˜è®¤å€¼</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒçš„è¿”å›å€¼</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­valueæ˜¯ä¸æ˜¯é€šè¿‡Promiseå®ä¾‹åŒ–å‡ºæ¥çš„ï¼ˆåˆ¤æ–­valueæ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼‰</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">else</span><span class="token punctuation">{</span>
								<span class="token comment">// ä¸æ˜¯Promiseå®ä¾‹ï¼Œå°†è¿”å›çš„PromiseçŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">// æœ‰å¼‚å¸¸ï¼Œå°†è¿”å›Promiseçš„çŠ¶æ€æ›´æ”¹ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºerr</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// çŠ¶æ€æˆåŠŸè°ƒç”¨onResolved</span>
				<span class="token comment">// p1çš„çŠ¶æ€ä¸ºæˆåŠŸ</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					<span class="token comment">// pending</span>
					<span class="token comment">// å¦‚æœçŠ¶æ€ä¸ºpending,é‚£ä¹ˆä¿å­˜æˆåŠŸä¸å¤±è´¥å›è°ƒ</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span><span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	Promise<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> value<span class="token punctuation">;</span><span class="token comment">// å¦‚æœæ˜¯Promiseå®ä¾‹ç›´æ¥è¿”å›</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœä¸æ˜¯Promiseå®ä¾‹ï¼Œé‚£ä¹ˆè¿”å›çš„çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	Promise<span class="token punctuation">.</span><span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-22-å®Œæˆall" tabindex="-1"><a class="header-anchor" href="#_15-22-å®Œæˆall" aria-hidden="true">#</a> 15.22 å®Œæˆall</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// æ¥æ”¶æ‰§è¡Œå™¨å‡½æ•°(executor)ï¼Œæ‰§è¡Œå™¨å‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œï¼ˆç«‹å³æ‰§è¡Œï¼‰ã€‚</span>
	<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹çŠ¶æ€</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹å€¼</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">// _resolveå‡½æ•°å°†çŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸï¼ŒæˆåŠŸå€¼ä¸ºæ¥æ”¶çš„value</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœçŠ¶æ€å·²ç»æ›´æ”¹ï¼Œç›´æ¥è·³å‡ºå‡½æ•°ä½“</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸ</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">// æ›´æ–°æˆåŠŸå€¼</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// _rejectå‡½æ•°å°†çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œå¤±è´¥å€¼ä¸ºæ¥æ”¶çš„value</span>
		<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœçŠ¶æ€å·²ç»æ›´æ”¹ï¼Œç›´æ¥è·³å‡ºå‡½æ•°ä½“</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">// æ›´æ–°å¤±è´¥å€¼</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span> _reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœæœ‰å¼‚å¸¸ï¼Œå°†çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œå¤±è´¥çš„å€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
			<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// å°†ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯¹è±¡ï¼‰åˆå¹¶è‡³Promise.prototypeå¯¹è±¡ä¸­ã€‚</span>
	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token comment">// 1- æ¥æ”¶æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
		<span class="token comment">// 2- è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå®ä¾‹</span>
		<span class="token comment">// 3- onResolvedæˆåŠŸå›è°ƒï¼Œé»˜è®¤å€¼ä¸ºvalue=&gt;value;</span>
		<span class="token comment">// 4- onRejectedå¤±è´¥å›è°ƒï¼Œé»˜è®¤å€¼ä¸ºreason=&gt;{throw reason};</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// onResolvedæˆåŠŸå›è°ƒï¼Œé»˜è®¤å€¼ä¸ºvalue=&gt;value;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
			<span class="token comment">//onRejectedå¤±è´¥å›è°ƒï¼Œé»˜è®¤å€¼ä¸ºreason=&gt;{throw reason};</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> reason
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// callbackæ˜¯æˆåŠŸæˆ–å¤±è´¥å›è°ƒ</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span> <span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒè¿”å›ç»“æœ</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºPromiseå®ä¾‹</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
								<span class="token comment">// éPromiseå®ä¾‹</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span>
				<span class="token comment">// åˆ¤æ–­çŠ¶æ€ä¸ºæˆåŠŸï¼Œè°ƒç”¨æˆåŠŸå›è°ƒ</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	Promise<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// åˆ¤æ–­æ¥æ”¶çš„å‚æ•°æ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å›</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token comment">// å¦‚æœä¸æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Promise,çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue;</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	Promise<span class="token punctuation">.</span><span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// è¿”å›å¤±è´¥çš„Promise,å¤±è´¥å€¼ä¸ºæ¥æ”¶çš„value</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 1- æ¥æ”¶çš„æ˜¯æ•°ç»„ï¼Œè¿”å›çš„æ˜¯Promise</span>
	Promise<span class="token punctuation">.</span><span class="token function-variable function">all</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> successArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			promiseArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span>i</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					index<span class="token operator">++</span><span class="token punctuation">;</span>
					successArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> promiseArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>successArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">s</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token comment">// è¿”å›Promiseçš„çŠ¶æ€è®¾ç½®å¤±è´¥</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// allæ¥æ”¶çš„æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯Promiseå®ä¾‹ã€‚</span>
<span class="token comment">// å…ƒç´ ä¸­çš„Promiseå®ä¾‹éƒ½æˆåŠŸï¼Œpçš„çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºæ•°ç»„ï¼Œæ•°ç»„çš„å…ƒç´ ä¸ºæˆåŠŸå€¼</span>
<span class="token comment">// å…ƒç´ ä¸­æœ‰ä¸€ä¸ªå¤±è´¥ï¼Œé‚£ä¹ˆpçš„çŠ¶æ€ä¸ºå¤±è´¥ï¼Œå€¼ä¸ºå¤±è´¥å€¼</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">,</span>p4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-23-å®Œæˆrace" tabindex="-1"><a class="header-anchor" href="#_15-23-å®Œæˆrace" aria-hidden="true">#</a> 15.23 å®Œæˆrace</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¥æ”¶æ‰§è¡Œå™¨å‡½æ•°(executor)ï¼Œæ‰§è¡Œå™¨å‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œï¼ˆç«‹å³æ‰§è¡Œï¼‰ã€‚</span>
    <span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹çŠ¶æ€</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹å€¼</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// _resolveå‡½æ•°å°†çŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸï¼ŒæˆåŠŸå€¼ä¸ºæ¥æ”¶çš„value</span>
        <span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€å·²ç»æ›´æ”¹ï¼Œç›´æ¥è·³å‡ºå‡½æ•°ä½“</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸ</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">// æ›´æ–°æˆåŠŸå€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// _rejectå‡½æ•°å°†çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œå¤±è´¥å€¼ä¸ºæ¥æ”¶çš„value</span>
        <span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœçŠ¶æ€å·²ç»æ›´æ”¹ï¼Œç›´æ¥è·³å‡ºå‡½æ•°ä½“</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">// æ›´æ–°å¤±è´¥å€¼</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span> _reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœæœ‰å¼‚å¸¸ï¼Œå°†çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œå¤±è´¥çš„å€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
            <span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å°†ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯¹è±¡ï¼‰åˆå¹¶è‡³Promise.prototypeå¯¹è±¡ä¸­ã€‚</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1- æ¥æ”¶æˆåŠŸä¸å¤±è´¥å›è°ƒå‡½æ•°</span>
        <span class="token comment">// 2- è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå®ä¾‹</span>
        <span class="token comment">// 3- onResolvedæˆåŠŸå›è°ƒï¼Œé»˜è®¤å€¼ä¸ºvalue=&gt;value;</span>
        <span class="token comment">// 4- onRejectedå¤±è´¥å›è°ƒï¼Œé»˜è®¤å€¼ä¸ºreason=&gt;{throw reason};</span>
        <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// onResolvedæˆåŠŸå›è°ƒï¼Œé»˜è®¤å€¼ä¸ºvalue=&gt;value;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
            <span class="token comment">//onRejectedå¤±è´¥å›è°ƒï¼Œé»˜è®¤å€¼ä¸ºreason=&gt;{throw reason};</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> reason
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// callbackæ˜¯æˆåŠŸæˆ–å¤±è´¥å›è°ƒ</span>
                <span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒè¿”å›ç»“æœ</span>
                            <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºPromiseå®ä¾‹</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                <span class="token comment">// éPromiseå®ä¾‹</span>
                                <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>

                <span class="token punctuation">}</span>
                <span class="token comment">// åˆ¤æ–­çŠ¶æ€ä¸ºæˆåŠŸï¼Œè°ƒç”¨æˆåŠŸå›è°ƒ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">onResolved</span><span class="token operator">:</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">onRejected</span><span class="token operator">:</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­æ¥æ”¶çš„å‚æ•°æ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å›</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœä¸æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Promise,çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    Promise<span class="token punctuation">.</span><span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// è¿”å›å¤±è´¥çš„Promise,å¤±è´¥å€¼ä¸ºæ¥æ”¶çš„value</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 1- æ¥æ”¶çš„æ˜¯æ•°ç»„ï¼Œè¿”å›çš„æ˜¯Promise</span>
    Promise<span class="token punctuation">.</span><span class="token function-variable function">all</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> successArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            promiseArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span>i</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    index<span class="token operator">++</span><span class="token punctuation">;</span>
                    successArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> promiseArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>successArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">s</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token comment">// è¿”å›Promiseçš„çŠ¶æ€è®¾ç½®å¤±è´¥</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    Promise<span class="token punctuation">.</span><span class="token function-variable function">race</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            promiseArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">// value.then(v=&gt;{</span>
                <span class="token comment">// 	resolve(v);</span>
                <span class="token comment">// },s=&gt;{</span>
                <span class="token comment">// 	reject(s);</span>
                <span class="token comment">// })</span>
                value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// race:è¿”å›çš„æ˜¯Promiseå®ä¾‹ï¼Œè°å…ˆæ‰§è¡Œå®Œå°±ä¸è°çš„çŠ¶æ€ä»¥åŠå€¼ç›¸åŒã€‚</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">,</span>p4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_15-24-classç‰ˆæœ¬å®ç°promise" tabindex="-1"><a class="header-anchor" href="#_15-24-classç‰ˆæœ¬å®ç°promise" aria-hidden="true">#</a> 15.24 classç‰ˆæœ¬å®ç°Promise</h4><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 1-å°†ä¹‹å‰æ„é€ å‡½æ•°ä½“å†…çš„è¯­å¥æ”¾ç½®åˆ°constructorå‡½æ•°ä¸­</span>
	<span class="token comment">// 2-å°†ä¹‹å‰prototypeçš„å±æ€§ç›´æ¥æ”¾ç½®åˆ°Promiseä¸­</span>
	<span class="token keyword">class</span> <span class="token class-name">Promise</span><span class="token punctuation">{</span>
		<span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// åˆ¤æ–­æ¥æ”¶çš„å‚æ•°æ˜¯å¦ä¸ºPromiseå®ä¾‹ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å›</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token comment">// å¦‚æœä¸æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Promise,çŠ¶æ€ä¸ºæˆåŠŸï¼Œå€¼ä¸ºvalue;</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">static</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// è¿”å›å¤±è´¥çš„Promise,å¤±è´¥å€¼ä¸ºæ¥æ”¶çš„value</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token function">reject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">static</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">let</span> successArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				promiseArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span>i</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						index<span class="token operator">++</span><span class="token punctuation">;</span>
						successArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> promiseArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token function">resolve</span><span class="token punctuation">(</span>successArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">s</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token comment">// è¿”å›Promiseçš„çŠ¶æ€è®¾ç½®å¤±è´¥</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">static</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				promiseArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token comment">// value.then(v=&gt;{</span>
					<span class="token comment">// 	resolve(v);</span>
					<span class="token comment">// },s=&gt;{</span>
					<span class="token comment">// 	reject(s);</span>
					<span class="token comment">// })</span>
					value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹çŠ¶æ€</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token comment">// åˆå§‹å€¼</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token comment">// _resolveå‡½æ•°å°†çŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸï¼ŒæˆåŠŸå€¼ä¸ºæ¥æ”¶çš„value</span>
			<span class="token keyword">const</span> <span class="token function-variable function">_resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// å¦‚æœçŠ¶æ€å·²ç»æ›´æ”¹ï¼Œç›´æ¥è·³å‡ºå‡½æ•°ä½“</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸ</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">// æ›´æ–°æˆåŠŸå€¼</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// _rejectå‡½æ•°å°†çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œå¤±è´¥å€¼ä¸ºæ¥æ”¶çš„value</span>
			<span class="token keyword">const</span> <span class="token function-variable function">_reject</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// å¦‚æœçŠ¶æ€å·²ç»æ›´æ”¹ï¼Œç›´æ¥è·³å‡ºå‡½æ•°ä½“</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span><span class="token comment">// çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span><span class="token comment">// æ›´æ–°å¤±è´¥å€¼</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token function">executor</span><span class="token punctuation">(</span>_resolve<span class="token punctuation">,</span> _reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// å¦‚æœæœ‰å¼‚å¸¸ï¼Œå°†çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œå¤±è´¥çš„å€¼ä¸ºå¼‚å¸¸ä¿¡æ¯</span>
				<span class="token function">_reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// onResolvedæˆåŠŸå›è°ƒï¼Œé»˜è®¤å€¼ä¸ºvalue=&gt;value;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onResolved <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
			<span class="token comment">//onRejectedå¤±è´¥å›è°ƒï¼Œé»˜è®¤å€¼ä¸ºreason=&gt;{throw reason};</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>onRejected <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> reason
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token comment">// callbackæ˜¯æˆåŠŸæˆ–å¤±è´¥å›è°ƒ</span>
				<span class="token keyword">const</span> <span class="token function-variable function">_common</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">try</span> <span class="token punctuation">{</span>
							<span class="token comment">// valueæ˜¯æˆåŠŸå›è°ƒè¿”å›ç»“æœ</span>
							<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºPromiseå®ä¾‹</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
								<span class="token comment">// éPromiseå®ä¾‹</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span>
				<span class="token comment">// åˆ¤æ–­çŠ¶æ€ä¸ºæˆåŠŸï¼Œè°ƒç”¨æˆåŠŸå›è°ƒ</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>callbackFn<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">onResolved</span><span class="token operator">:</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onResolved<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token literal-property property">onRejected</span><span class="token operator">:</span> <span class="token function">_common</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	window<span class="token punctuation">.</span>Promise <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// race:è¿”å›çš„æ˜¯Promiseå®ä¾‹ï¼Œè°å…ˆæ‰§è¡Œå®Œå°±ä¸è°çš„çŠ¶æ€ä»¥åŠå€¼ç›¸åŒã€‚</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">,</span>p4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/KurobaKaitou/docs/edit/main/docs/frontend/promise/README.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ"><!--[--><!--]--> ç¼–è¾‘æ­¤é¡µ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1537372358@qq.com">tanzhilin</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="comment"><!----></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/docs/assets/app-62a6500d.js" defer></script>
  </body>
</html>
